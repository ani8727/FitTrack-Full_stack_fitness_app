
server:
  port: ${PORT:8085}

spring:
  application:
    name: api-gateway
  cloud:
    discovery:
      enabled: false
    config:
      enabled: false
    server:
      port: ${PORT:8085}

    management:
      endpoints:
        web:
          exposure:
            include: health,info
          cors:
            allowed-origins: ${CORS_ALLOWED_ORIGINS:*}
            allowed-methods: "*"
            allowed-headers: "*"
            allow-credentials: true

    spring:
      application:
        name: api-gateway

      security:
        oauth2:
          resourceserver:
            jwt:
              jwk-set-uri: ${AUTH0_JWK_SET_URI}

      cloud:
        config:
          enabled: false
        discovery:
          enabled: false
        gateway:
          server:
            webflux:
              routes:
                - id: user-service
                  uri: ${USER_SERVICE_URL}
                  predicates:
                    - Path=/api/users/**
                  filters:
                    - StripPrefix=0

                - id: activity-service
                  uri: ${ACTIVITY_SERVICE_URL}
                  predicates:
                    - Path=/api/activities/**
                  filters:
                    - StripPrefix=0

                - id: ai-service
                  uri: ${AI_SERVICE_URL}
                  predicates:
                    - Path=/api/ai/**
                  filters:
                    - StripPrefix=0

                - id: ai-recommendations
                  uri: ${AI_SERVICE_URL}
                  predicates:
                    - Path=/api/recommendations/**
                  filters:
                    - StripPrefix=0

                - id: ai-daily-plans
                  uri: ${AI_SERVICE_URL}
                  predicates:
                    - Path=/api/daily-plans/**
                  filters:
                    - StripPrefix=0

                - id: admin-service
                  uri: ${ADMIN_SERVICE_URL}
                  predicates:
                    - Path=/api/admin/**
                  filters:
                    - StripPrefix=0

              httpclient:
                pool:
                  max-connections: ${GATEWAY_MAX_CONNECTIONS:200}
                connect-timeout: 10000
                response-timeout: 30s
