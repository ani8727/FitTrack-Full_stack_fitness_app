@startuml Activity_Service_Components
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Component Diagram - Activity Service Internal Architecture

Container_Boundary(c1, "Activity Service") {
    Component(controller, "ActivityController", "Spring MVC Controller", "REST endpoints for activity operations")
    Component(adminController, "AdminController", "Spring MVC Controller", "Admin-specific activity endpoints")
    
    Component(activityService, "ActivityService", "Business Service", "Core activity tracking logic")
    Component(statisticsService, "StatisticsService", "Business Service", "Activity analytics and calculations")
    Component(validationService, "ValidationService", "Business Service", "Activity data validation")
    
    Component(eventPublisher, "EventPublisher", "Integration Component", "Activity event publishing")
    Component(calorieCalculator, "CalorieCalculator", "Utility Component", "Automatic calorie calculation")
    
    Component(activityRepo, "ActivityRepository", "Spring Data MongoDB", "Activity document persistence")
    Component(statisticsRepo, "StatisticsRepository", "Spring Data MongoDB", "Pre-computed statistics storage")
}

ContainerDb(mongo, "MongoDB", "Activity data storage")
ContainerDb(cache, "Redis", "Statistics caching")
ContainerQueue(mq, "RabbitMQ", "Event messaging")

' Controller relationships
Rel(controller, activityService, "Uses")
Rel(controller, statisticsService, "Uses")
Rel(adminController, activityService, "Uses")
Rel(adminController, statisticsService, "Uses")

' Service relationships
Rel(activityService, activityRepo, "Persists via")
Rel(activityService, validationService, "Validates with")
Rel(activityService, calorieCalculator, "Calculates calories")
Rel(activityService, eventPublisher, "Publishes events")

Rel(statisticsService, statisticsRepo, "Accesses via")
Rel(statisticsService, activityRepo, "Queries via")

' External integrations
Rel(activityRepo, mongo, "Queries", "MongoDB Driver")
Rel(statisticsRepo, mongo, "Queries", "MongoDB Driver")
Rel(statisticsService, cache, "Caches stats", "Redis")
Rel(eventPublisher, mq, "Publishes", "AMQP")

@enduml